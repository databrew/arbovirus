
### Autochthonous arbovirus transmission status

#### Arboviruses that have circulated autochthonously in the region (percentage of responding countries) at any time since 2000 (ref Q5)

```{r}

# relevant question: q5

responses <- get_responses("5")
other <- responses %>% select(Other)
other <- cbind( Region = data$Region, other) %>% 
  drop_na(Region) %>%
  drop_na( Other ) %>%
  group_by( Region ) %>%
  summarize( Other = paste0( unique( unlist( strsplit( paste0(Other, collapse = ", "), ", ", fixed=TRUE))), collapse = ", ")) %>%
  ungroup()
responses <- responses %>% select(-Other) 
qdf <- cbind( Region = data$Region, responses) %>% 
  drop_na(Region) 
nums <- qdf %>% 
  group_by( Region ) %>%
  tally(name = "n_countries")
qdf %>% 
  pivot_longer(!Region, names_to="Arbovirus", values_to="Response") %>% 
  mutate( Arbovirus = recode_factor(.x = Arbovirus,
                                    "Chikungunya"="CHIKV",
                                    "Dengue"="DENV",
                                    "Yellow fever"="YFV",
                                    "Zika"="ZIKV")) %>%
  mutate( Response = factor( replace_na( as.character(Response), "Unanswered"))) %>%
  mutate( Response = fct_relevel(Response, "Yes", "Not selected", "Unanswered")) %>%
  group_by(Region, Arbovirus, Response) %>% 
  tally %>%
  ungroup() %>% 
  left_join( nums, by="Region") %>%
  mutate( Percentage = round(100*n/n_countries)) %>%
  filter( Response == "Yes" ) %>%
  select( -c(Response,n_countries) ) %>%
  mutate( Percentage = paste0("(", Percentage, "%)")) %>%
  unite( "n", n:Percentage, sep = " ") %>%
  pivot_wider( names_from=Arbovirus, values_from=n) %>%
  mutate( across(!Region, ~replace_na(., "0 (0%)"))) %>%
  left_join( other, by="Region") %>%
  rename("Regional office" = Region ) %>%
  regulartable %>% 
  theme_zebra(odd_header="#048ECA", odd_body = "#D6EAF8") %>% 
  color( color="#FFFFFF", part="header" ) %>% 
  align( j=2:5, align="center", part="all" ) %>%
  valign( valign = "top", part="header" ) %>%
  padding( padding.top = 10, part="all") %>%
  padding( padding.bottom = 10, part="all") %>%
  autofit() 

```
