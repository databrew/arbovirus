---
title: "Regional response capacity indicators"
---

```{r, include=FALSE, echo = FALSE}
# Basic knitr options
library(knitr)
opts_chunk$set(comment = NA, 
               echo = FALSE,
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE,
               fig.width = 9.64,
               fig.height = 5.9,
               fig.path = 'figures/')
ggplot2::theme_set(ggplot2::theme_bw())

# options(scipen = '999')
```

```{js}
element = document.getElementById('WHO_logo');
console.log(element)

$('#WHO_logo').click(function(e){
    console.log("Exists!")
});


window.onscroll = function() { scrollFunction() };

var navbar = document.getElementById("navbar");
var logoWhiteElement = document.getElementById("whiteLogoPosition")
var sticky = navbar.offsetTop;

function scrollFunction() {
  if (window.pageYOffset >= sticky) {
    navbar.classList.add("sticky");
    logoWhiteElement.classList.add("white_logo_appear");
  } else {
    navbar.classList.remove("sticky");
    logoWhiteElement.classList.remove("white_logo_appear");
  }
}

$(document).on('click', function (e){
    /* Global data  */
    var global_menu_opened = $('#global-navigation').hasClass('in');
    if(!$(e.target).closest('#global-navigation').length &&
        !$(e.target).is('#global-navigation') &&
        global_menu_opened === true){
            $('#global-navigation').collapse('toggle');
            $( "#Global-Li-area" ).removeClass("activeMenuState");
    }
    
    if ($('#global-navigation').attr('aria-expanded') === "false") {
      $( "#Global-Li-area" ).removeClass("activeMenuState");
    }
    if ($('#global-navigation').attr('aria-expanded') === "true") {
      $( "#Global-Li-area" ).addClass("activeMenuState");
    }

     /* Regional data  */
    var regional_menu_opened = $('#regional-navigation').hasClass('in');
    if(!$(e.target).closest('#regional-navigation').length &&
        !$(e.target).is('#regional-navigation') &&
        regional_menu_opened === true){
            $('#regional-navigation').collapse('toggle');
            $( "#Regional-Li-area" ).removeClass("activeMenuState");
    }
    
    if ($('#regional-navigation').attr('aria-expanded') === "false") {
      $( "#Regional-Li-area" ).removeClass("activeMenuState");
    }
    if ($('#regional-navigation').attr('aria-expanded') === "true") {
      $( "#Regional-Li-area" ).addClass("activeMenuState");
    }
     
     
     /* Country data  */
    var country_menu_opened = $('#country-navigation').hasClass('in');
    if(!$(e.target).closest('#country-navigation').length &&
        !$(e.target).is('#country-navigation') &&
        country_menu_opened === true){
            $('#country-navigation').collapse('toggle');
            $( "#Country-Li-area" ).removeClass("activeMenuState");
    }
    
    if ($('#country-navigation').attr('aria-expanded') === "false") {
      $( "#Country-Li-area" ).removeClass("activeMenuState");
    }
    if ($('#country-navigation').attr('aria-expanded') === "true") {
      $( "#Country-Li-area" ).addClass("activeMenuState");
    }


});

```


```{r, child="_sessioninfo.Rmd"}
```

```{r, echo = FALSE}
source('functions.R')
dict <- load_dict()
df <- load_data()
```

## Indicators used for thresholds

#### For the last two years, did your country have a plan for mosquito-borne disease control that includes a threshold (e.g., level of vector mosquito abundance or minimum infection rate) that would result in a recommendation for mosquito adulticiding/other mosquito reduction measures? (Question 37) 

```{r}

# relevant question: q37

responses <- get_responses("37")
qdf <- data.frame(Region = df$Region, Response = responses) %>% 
  drop_na(Region) %>% 
  mutate( Response = factor( replace_na( as.character(Response), "Unanswered"))) %>%
  mutate( Response = recode_factor(Response, 
                                 "Yes, have a threshold that requires concurrent human cases" = "Yes, have a threshold that requires concurrent human cases",
                                 "Yes, have a threshold that does not require concurrent human cases" = "Yes, have a threshold that does not require concurrent human cases",
                                  "No – have a plan but there is no specific threshold" = "No, have a plan but there is no specific threshold",
                                  "No – do not have a formal plan that includes adulticiding to control mosquito-borne diseases" = "No, do not have a formal plan that includes adulticiding to control mosquito-borne diseases",
                                 "Unanswered" = "Unanswered")) %>% 
  group_by(Region, Response) %>%
  tally 
qdf %>% 
  pivot_wider(names_from=Response, values_from=n) %>%
  mutate( across( everything(), ~ replace_na(.x, 0))) %>% 
  adorn_totals() %>%
  regulartable() %>%
  hline(i=4) %>%
  autofit 

```

#### Which indicator(s) is(are) used as threshold(s)? (Question 37b) 

```{r}

# relevant question: q37b

responses <- get_responses("37b") %>%
  select(-Other)

qdf <- cbind(Region = df$Region, responses) %>% 
  pivot_longer(!Region, names_to="Indicator", values_to="Response") %>% 
  mutate( Response = factor( replace_na( as.character(Response), "Unanswered"))) %>%
  mutate( Response = fct_relevel(Response, "Yes", "Not selected", "Unanswered")) %>%
  group_by(Region, Indicator, Response) %>% 
  tally
qdf %>% 
  pivot_wider(names_from=Response, values_from=n) %>% 
  mutate( across( everything(), ~ replace_na(.x, 0))) %>% 
  drop_na(Region) %>% 
  regulartable() %>% 
  merge_v(j = ~Region) %>% 
  valign(j = 1, valign = "top", part = "all") %>% 
  hline(i=6*(1:4)) %>% 
  fix_border_issues() %>%
  autofit() 

```

#### Overall, are data on any of the following arboviral outbreak risk factors routinely collected and analysed? (Select all that apply)  (Question 38) 

```{r}

# relevant question: q38

responses <- get_responses("38") %>%
  select(-Other)

qdf <- cbind(Region = df$Region, responses) %>% 
  pivot_longer(!Region, names_to="Factor", values_to="Response") %>% 
  mutate( Response = factor( replace_na( as.character(Response), "Unanswered"))) %>%
  mutate( Response = fct_relevel(Response, "Yes", "Not selected", "Unanswered")) %>%
  mutate( Factor = fct_relevel(Factor,
                               "Breteau Index",
                               "Container Index",
                               "House Index",
                               "Migration of a non-immune population",
                               "Rainfall",
                               "Temperatures",
                               "None")) %>%
  group_by(Region, Factor, Response) %>% 
  tally
qdf %>% 
  pivot_wider(names_from=Response, values_from=n) %>% 
  mutate( across( everything(), ~ replace_na(.x, 0))) %>% 
  drop_na(Region) %>% 
  regulartable() %>% 
  merge_v(j = ~Region) %>% 
  valign(j = 1, valign = "top", part = "all") %>% 
  hline(i=7*(1:4)) %>% 
  fix_border_issues() %>%
  # width( j=2, width=2 ) %>%
  autofit() 

```

