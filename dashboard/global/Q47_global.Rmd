
### Preparedness for arboviral outbreaks/epidemics

#### Outbreak committee presence, staff training, contingency hospital service plan and emergency funding (ref Q47, 48, 50, 52, 53)

```{r}
q47 <- get_responses("47") %>%
  drop_na( Response )
q47 <- cbind( Region = data$Region, q47 )

nums <- q47 %>% 
  group_by( Region ) %>%
  tally(name = "n_countries")

q47 <- q47 %>%
  filter(Response == "Yes") %>% 
  group_by(Region) %>%
  tally( name="Outbreak committee in place")

q48 <- get_responses("48") %>%
  drop_na( Response )
q48 <- cbind( Region = data$Region, q48 ) %>%
  filter( Response == "Yes" ) %>%
  group_by(Region) %>%
  tally( name = "Staff/committee training for outbreaks" )

q52 <- get_responses("52") %>%
  filter( if_any( everything(), ~ !is.na(.x))) %>% 
  mutate( "Emergency fund" = ifelse( `National level`=="Yes" | `State/local level` == "Yes", 1, 0 ) ) %>%
  select( `Emergency fund` )
q52 <- cbind( Region = data$Region, q52 ) %>%
  group_by(Region) %>%
  summarize("Emergency fund" = sum(`Emergency fund`, na.rm=TRUE))

q53 <- get_responses("53") %>%
  drop_na( Response )
q53 <- cbind( Region = data$Region, q53 ) %>%
  filter( Response == "Yes" ) %>%
  group_by(Region) %>%
  tally( name = "Contingency plan for healthcare services in emergencies" )

q50 <- get_responses("50")
colnames( q50 ) <- c("Response", "Institutions")
q50 <- q50 %>%
  filter( if_any( everything(), ~ !is.na(.x))) 
q50$Response[ grep("Yes", q50$Response )] <- "Yes"
q50 <- cbind( Region=data$Region, q50 ) %>%
  filter(Response=="Yes") %>%
  group_by(Region) %>%
  tally( name = "Collaborating institutions (regional network)")

list( nums, q47, q48, q53, q52, q50 ) %>%
  reduce( left_join, by="Region") %>%
  group_by( Region ) %>%
  mutate( across( everything(), replace_na, 0)) %>% 
  mutate( across( everything(), ~ paste0( .x, " (", round(100*(.x)/n_countries), "%)") ) ) %>%
  select( -n_countries ) %>%
  rename("Regional office" = Region ) %>%
  regulartable() %>% 
  theme_zebra(odd_header="#048ECA", odd_body = "#D6EAF8") %>% 
  color( color="#FFFFFF", part="header" ) %>% 
  align( j=2:6, align="center", part="all") %>%
  valign( valign = "top", part="header" ) %>%
  padding( padding.top = 10, part="all") %>%
  padding( padding.bottom = 10, part="all") %>%
  autofit()

```
