
### Autochthonous arbovirus transmission status

#### Arboviruses that have circulated autochthonously in the region (percentage of responding countries) at any time since 2000 (ref Q5)

```{r}

# relevant question: q5

responses <- get_responses("5")
other <- responses %>% select(Other)
other <- cbind( Region = data$Region, other) %>% 
  drop_na(Region) %>%
  drop_na( Other ) %>%
  group_by( Region ) %>%
  summarize( Other = paste0( unique( unlist( strsplit( paste0(Other, collapse = ", "), ", ", fixed=TRUE))), collapse = ", ")) %>%
  ungroup()
responses <- responses %>% select(-Other) 
qdf <- cbind( Region = data$Region, responses) %>% 
  drop_na(Region) 
nums <- qdf %>% 
  group_by( Region ) %>%
  tally(name = "n_countries")
qdf %>% 
  pivot_longer(!Region, names_to="Arbovirus", values_to="Response") %>% 
  mutate( Arbovirus = recode_factor(.x = Arbovirus,
                                    "Chikungunya"="CHIKV",
                                    "Dengue"="DENV",
                                    "Yellow fever"="YFV",
                                    "Zika"="ZIKV")) %>%
  mutate( Response = factor( replace_na( as.character(Response), "Unanswered"))) %>%
  mutate( Response = fct_relevel(Response, "Yes", "Not selected", "Unanswered")) %>%
  group_by(Region, Arbovirus, Response) %>% 
  tally %>%
  ungroup() %>% 
  left_join( nums, by="Region") %>%
  mutate( Percentage = round(100*n/n_countries)) %>%
  filter( Response == "Yes" ) %>%
  select( -c(Response,n_countries) ) %>%
  mutate( Percentage = paste0("(", Percentage, "%)")) %>%
  unite( "n", n:Percentage, sep = " ") %>%
  pivot_wider( names_from=Arbovirus, values_from=n) %>%
  mutate( across(!Region, ~replace_na(., "0 (0%)"))) %>%
  left_join( other, by="Region") %>%
  rename("Regional office" = Region ) %>%
  regulartable %>% 
  theme_zebra(odd_header="#048ECA", odd_body = "#D6EAF8") %>% 
  color( color="#FFFFFF", part="header" ) %>% 
  align( j=2:5, align="center", part="all" ) %>%
  valign( valign = "top", part="header" ) %>%
  padding( padding.top = 10, part="all") %>%
  padding( padding.bottom = 10, part="all") %>%
  autofit() 

```


```{r eval=FALSE}

main_viruses <- data.frame( "Virus" = "Virus acronyms", 
                  CHIKV = c("CHIKV","chikungunya virus"), 
                  DENV = c("DENV","dengue virus"), 
                  YFV = c("YFV","yellow fever virus"),
                  ZIKV = c("ZIKV","zika virus"))
regulartable(main_viruses) %>% 
  merge_v(j=1, part="body") %>% 
  theme_zebra(odd_header="#048ECA", even_header="#048ECA", odd_body = "#D6EAF8") %>% 
  delete_part(part = "header") %>%
  autofit()
```

<br>

```{r}
other_viruses <- data.frame( "Virus" = "Other viruses", 
                  CCHFV = c("CCHFV","Crimean Congo haemorrhagic fever virus"), 
                  EEEV = c("EEEV","Eastern equine encephalitis virus"), 
                  MAYV = c("MAYV","Mayaro virus"),
                  OROV = c("OROV","Oropouche virus"), 
                  RVFV = c("RVFV","Rift Valley fever virus"), 
                  SFFV = c("SFFV","Sand fly fever virus (Naples, Sicilian)"), 
                  TBEV = c("TBEV","Tick-borne encephalitis virus"), 
                  TOSV = c("TOSV","Toscana virus"),
                  VEEV = c("VEEV","Venezuelan equine encephalitis virus"), 
                  WNV = c("WNV","West Nile virus"))

regulartable(other_viruses) %>% 
  merge_v(j=1, part="body") %>% 
  theme_zebra(odd_body = "#048ECA") %>% 
  delete_part(part = "header") %>%
  color( i=1, color="#FFFFFF", part="body" ) %>% 
  autofit()

```
